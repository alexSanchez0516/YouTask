async function showContacts(){const e=document.querySelector("#container__users");try{const t="http://127.0.0.1:8080/api/friends",n=await fetch(t);let s="";(await n.json())[1].forEach(t=>{s+=`\n          <li class="follower__contact my-3  d-flex" data-chat="${t.id}">\n            <div class="user  w-20">\n                <img src="/build/img/${t.avatar}" data-avatar="/build/img/${t.avatar}" class="raidius_max w-100 " alt="Retail Admin">\n            </div>\n            <p class="name-time align-self-center text-dark mx-2">\n                <span class="name_users_on_chat">${t.username}</span> \n            </p>\n\n          </li>\n        `,e.innerHTML=s}),showChatOnClick(0)}catch(e){console.log(e)}}function showChatOnClick(e){const t=document.querySelectorAll(".follower__contact"),n=document.querySelector("#selected-user"),s=document.querySelector("#chat__box__container");let a="";t.forEach(t=>{t.addEventListener("click",o=>{if(e!=t.dataset.chat){let o=Number(t.getAttribute("data-chat")),i="http://127.0.0.1:8080/api/chat/app";$.post(i,{idSelected:o},o=>{const i=JSON.parse(o);let c=t.children[1].children[0].textContent,r=t.children[0].children[0].getAttribute("data-avatar");n.textContent=c,i.forEach(e=>{e.isGroup;1==e.isSender?(console.log("es sender"),a+=`\n            <li class="chat-left d-flex align-items-center my-2">\n                <div class="chat-avatar w-10">\n                    <img src="${r}"  class="raidius_max w-100" alt="Retail Admin">\n                    <div class="chat-name">Tú</div>\n                </div>\n                <div class="chat-text mb-2 mx-2">\n                  ${e.msg}\n                </div>\n            </li>\n             `):a+=` \n                <li class="chat-right d-flex justify-content-end my-2">\n                    <div class="chat-text">\n                      ${e.msg}\n                    </div>\n                    <div class="chat-avatar mx-2 w-10">\n                        <img src="${r}" class="raidius_max w-100" alt="Retail Admin">\n                        <div class="chat-name">${c}</div>\n                    </div>\n                </li>\n            `}),e=t.dataset.chat,s.innerHTML=a})}})})}function createSkill(){let e=$("#skill_name").val();console.log(e);const t=document.querySelector("#btn_close_skill_user"),n=document.querySelector("#skills_data");$.post("http://127.0.0.1:8080/api/create-skill",{skill:e},e=>{JSON.parse(e)&&(t.click(),n.remove(),getSkills(),Swal.fire("Creado correctamente","","success"))})}function getSkills(){const e=document.createElement("select");e.setAttribute("id","skills_data"),e.setAttribute("name","skills[]"),e.setAttribute("multiple","multiple"),e.classList.add("form-select");const t=document.querySelector("#container_skills");let n="";$.get("http://127.0.0.1:8080/api/get-skills",s=>{JSON.parse(s).forEach(s=>{$.post("http://127.0.0.1:8080/api/check-skill",{skill:s.id},a=>{if(null!=a){const e=JSON.parse(a);n+=null!=e?`<option value="${s.id}" selected>${s.name}</option>`:`<option value="${s.id}" >${s.name}</option>`}e.innerHTML=n,t.appendChild(e)})})})}function openFileDialog(){document.querySelector("#image_avatar").click()}function previewImg(){if("/editar-perfil"==window.location.pathname){const e=document.querySelector("#current_img"),t=document.querySelector("#image_avatar");t.addEventListener("change",()=>{const n=t.files;if(n.length>0){const t=URL.createObjectURL(n[0]);e.src=t}})}}function storage(){}function deleteNotifications(){if(null!=document.querySelectorAll(".fa-xmark")){document.querySelectorAll(".fa-xmark").forEach(e=>{e.addEventListener("click",()=>{e.parentElement.remove()})})}}function getRequestsFollow(){let e=window.location.pathname;if(null==["/","/inicio","/login","/registro","/contacto"].find(t=>t==e)){let e="http://127.0.0.1:8080/api/show-requests-followers";const t=document.querySelector("#wrap__notifications");$.get(e,e=>{const n=JSON.parse(e);let s="";n.forEach(e=>{s+=`<div class="d-flex justify-content-between">\n        <span>Solicitud de Seguimiento de <a class=" " href="/seguidor?id=${e.id}">${e.username}</a></span>\n        <i class="fa-solid fa-xmark m-2"></i>\n        <button type="button" onclick="accept_request_follower(${e.id_request});" class="btn btn-primary m-2">Aceptar</button>\n        <button type="button" onclick="reject_request_follower(${e.id_request});" data-bs-dismiss="modal" class="btn btn-danger m-2">Denegar</button>\n      </div>  <hr/>`}),t.innerHTML=s,deleteNotifications()})}}function accept_request_follower(e){$.post("http://127.0.0.1:8080/api/accept-follower",{id_request:e},e=>{e&&(Swal.fire("Nuevo Seguidor","","success"),showFriends(),getRequestsFollow())})}function reject_request_follower(e){null!=e&&$.post("http://127.0.0.1:8080/api/accept-reject",{id_request:e},e=>{e&&getRequestsFollow()})}function send_request_friend(e){null!=e&&$.post("http://127.0.0.1:8080/api/send-resquest-friend",{receiver:e},e=>{Swal.fire(e)})}function search_profile(){if(null!=document.querySelector("#search_profile")){const e=document.querySelector("#btn__search__friends");e.classList.add("d-none");const t=document.querySelector("#search_profile");t.addEventListener("keyup",n=>{let s=t.value.trim();s.length>=3?(e.classList.remove("d-none"),e.classList.add("show")):e.classList.add("d-none"),$.ajax({url:"http://127.0.0.1:8080/api/search-friends-for-name",type:"POST",data:{search:s},success:e=>{if(!e.error&&null!=e){let t=JSON.parse(e),n=!1,s="";t.forEach(e=>{console.log(e);let t=e.id;$.post("http://127.0.0.1:8080/api/check-request-follower",{id:t},t=>{s+=`<div class="d-flex flex-column align-items-center ">\n                                  <img src="/build/img/${e.avatar}" class="img-responsive w-10" alt="avatar" />\n                                  <span>ID: ${e.id}</span>\n  \n                                  <span class="w-75 text-center">Nombre: <span class="text-primary">${e.username}</span></span>`,null!=e.description&&(s+=`\n                              <span class="w-75 text-center">Descripción: <span class="text-primary">${e.description}</span></span>`),null!=e.rol&&(s+=`\n                              <span class="w-75 text-center">Rol: <span class="text-primary">${e.rol}</span></span>`),s+=` <a href="/seguidor?id=${e.id}">Ver perfil</a>`;const a=JSON.parse(t);null!=a?null!=a.isAccept&&(1==a.isAccept?s+='<button type="button"  class="btn btn-primary my-2">\n                                      Seguido\n                                      </button>\n                                      <hr/>':s+=`<button type="button"  onclick="send_request_friend(${e.id});" \n                                    class="btn request_friends btn-secondary my-2">\n                                      Pendiente\n                                    </button>\n                                    <hr/>`):n=!0,n&&(s+=`<button type="button"  onclick="send_request_friend(${e.id});" \n                            class="btn request_friends btn-secondary my-2">\n                                      Seguir\n                            </button>\n                        <hr/>`),n=!1,s+="</div>",$("#content__profiles").html(s)})})}}})})}}function send_response_comment(){let e=window.location.href;document.querySelectorAll(".toogle_response").forEach(t=>{t.addEventListener("click",()=>{const n=t.dataset.id;$(".response_comment").submit(t=>{t.preventDefault();let s=document.querySelector("#container_post").dataset.id;const a={id_comment_response:n,content:$("#content").val(),post_id:s};$.post("http://127.0.0.1:8080/api/send_response_comment",a,t=>{window.location.href=e})})})})}function deletePost(){$(document).on("click","#delete_post",e=>{if(confirm("¿Seguro que quieres eliminar este post?")){let t=e.target.dataset.id;$.post("http://127.0.0.1:8080/api/post/delete",{id_element:t},e=>{listPosts()})}})}function update_post(){$(document).on("click","#update_post",e=>{let t=e.target.dataset.id;window.location.href="http://127.0.0.1:8080/modificar-post?id="+t})}function deleteFriend(){$(document).on("click",".delete_friend",e=>{if(confirm("¿Estas seguro que quieres eliminar este seguidor?")){let t=e.target.parentElement.parentElement.children[2].textContent;$.post("http://127.0.0.1:8080/api/friends/delete",{id_element:t},e=>{showFriends()})}})}function close_activity_perfil(){const e=document.querySelector("#close_activity_perfil"),t=document.querySelectorAll(".activity_perfil");null!=e&&e.addEventListener("click",(function(){t.forEach(t=>{t.classList.toggle("d-none"),t.classList.contains("d-none")?e.textContent="mostrar":e.textContent="ocultar"})}))}async function showFriends(){if("/seguidores"==window.location.pathname)try{const e="http://127.0.0.1:8080/api/friends",t=await fetch(e),n=await t.json();createFriendsList(n[1],n[0])}catch(e){console.log(e)}}function copyToClipboard(){const e=document.querySelector(".share");let t=e.dataset.text;e.addEventListener("click",()=>{navigator.clipboard.writeText(t).then(()=>{Swal.fire("Copiado correctamente")})})}async function listPosts(){let e=window.location.pathname;if("/posts"==e||"/perfil"==e)try{const e="http://127.0.0.1:8080/api/posts",t=await fetch(e),n=await t.json(),s=document.querySelector("#wrap-articles");template="",n.length>0?n.forEach(e=>{let t="https://www.youtask.es/post?id="+e.id;template+=`\n                    <article class="wrap-article m-2 d-flex flex-column">\n                        \n                        <div class="align-self-end">\n                            <button id="update_post" data-id="${e.id}" type="button" class="btn  my-2 btn-primary text-right text-end  " >Modificar</button>\n                            <button id="delete_post" data-id="${e.id}" type="button" class="btn  my-2 btn-danger text-right text-end" >Eliminar</button>\n                            \n                        </div>\n                        \n                        \n                        <span class="text-right d-block w-100 text-end">${e.create_at}</span>\n                        <h3><a class="text-decoration-none text-dark text-capitalize" href="/post?id=${e.id}">${e.name}</a></h3>\n                        <p>\n                            ${e.content.substring(0,500)}\n\n\n                            <a  href="/post?id=${e.id}"><svg class="mx-2" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal icon-lg text-muted pb-3px">\n                                    <circle cx="12" cy="12" r="1"></circle>\n                                    <circle cx="19" cy="12" r="1"></circle>\n                                    <circle cx="5" cy="12" r="1"></circle>\n                                </svg></a>\n                            </span>\n                        </p>\n                        <div>\n                            <div class="d-flex post-actions">\n                                \n                                <a href="javascript:;" class="d-flex mx-2 align-items-center text-muted">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share icon-md">\n                                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>\n                                        <polyline points="16 6 12 2 8 6"></polyline>\n                                        <line x1="12" y1="2" x2="12" y2="15"></line>\n                                    </svg>\n                                    <p class="d-none share d-md-block ml-2" data-text="${t}" onclick="copyToClipboard();">Compartir</p>\n                                </a>\n                            </div>\n                        </div>\n                    </article>\n                    <hr/>\n                    `}):template="<div><span>No hay artículos</span></div>","/perfil"===location.pathname&&(template+=' \n                <div class="d-flex justify-content-center mt-5">\n                    <button class="btn btn-secondary" onclick="window.location.href=\'/posts\'">Ver más</button>\n                </div>\n                '),s.innerHTML=template}catch(e){console.log(e)}}function createFriendsList(e,t){const n=document.querySelector("#container_friends")??0;(document.querySelector("#countFriends")??0).textContent="Lista de seguidores ("+t+")";let s="";e.length>0?e.forEach(e=>{s+=`\n            <div class="col-12 col-md-5 border rounded shadow m-2">\n                <div class="row">\n                    <div class="col-3" id="">\n                        <img id="avatar" src="/build/img/${e.avatar}" alt="avatar" srcset="" class="img-fluid m-2">\n                    </div>\n                    <div class="col-4 d-flex justify-content-center align-items-center">\n                        <span id="friend_username">${e.username}</span>\n                    </div>\n                    <div class="col-5 d-flex">\n                        <nav class="navbar navbar-expand-sm">\n                            <ul class="navbar-nav">\n                                <li class="nav-item dropdown">\n                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n                                        Acciones\n                                    </a>\n                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">\n                                        <li><a class="dropdown-item" href="/seguidor?id=${e.id}">Ver Perfil</a></li>\n                                        <li><a class="dropdown-item delete_friend" href="#">Eliminar</a></li>\n                                        <li class="d-none">${e.id}</li>\n                                        <li>\n                                            <hr class="dropdown-divider">\n                                        </li>\n                                        <li><a class="dropdown-item" href="#">Enviar mensaje</a></li>\n                                    </ul>\n                                </li>\n                            </ul>\n                        </nav>\n                    </div>\n                </div>\n            </div>\n            `}):s='<p class="text-center text-danger">No tienes seguidores agregados</p>',n.innerHTML=s}function showCreateProject(){const e=document.querySelector("#create_project"),t=document.querySelector("#wrap_initials"),n=document.querySelector("#wrap_create_project");null!=document.querySelector("#create_project")?null!=e?e.addEventListener("click",()=>{t.remove(),n.classList.add("show_wrap_create_project")}):n.classList.add("show_wrap_create_project"):null!=document.querySelector("#wrap_create_project")&&n.classList.add("show_wrap_create_project")}function checkPassword(){const e=document.querySelector("#password"),t=document.querySelector("#repeatPassword"),n=document.querySelector("#btn-register"),s=document.querySelector("#privacity");null!=s&&s.addEventListener("change",(function(){s.checked&&e.value==t.value&&n.classList.toggle("d-flex")}))}function checkAlerts(){if(document.querySelectorAll(".alerts")){document.querySelectorAll(".alerts").forEach(e=>{setTimeout(()=>{e.remove()},6e3)})}}function showMenuResponse(){const e=document.querySelector(".fa-bars"),t=document.querySelector(".nav__menu"),n=document.querySelector(".nav__list");null!=e&&e.addEventListener("click",()=>{t.classList.toggle("d-flex"),n.classList.toggle("flex-column")})}document.addEventListener("DOMContentLoaded",(function(){let e=window.location.pathname;checkPassword(),checkAlerts(),showMenuResponse(),showCreateProject(),close_activity_perfil(),showFriends(),deleteFriend(),listPosts(),deletePost(),update_post(),send_response_comment(),search_profile(),getRequestsFollow(),storage(),previewImg(),"/editar-perfil"==e&&getSkills(),"/mensajes"==e&&showContacts()}));